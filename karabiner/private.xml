<?xml version="1.0"?>
<root>
  <appdef>
    <appname>TERMINAL</appname>
    <equal>com.googlecode.iterm2</equal>
  </appdef>

  <vkopenurldef>
    <name>KeyCode::VK_OPEN_URL_toggle_keyup</name>
    <url type="shell">
      <![CDATA[
        /usr/bin/osascript <<EOF
        if application "KeyUp" is running then
          tell application "System Events" to tell process "KeyUp"
              click menu bar item 1 of menu bar 2 -- Click menu bar icon
          end tell
        else
          activate application "KeyUp"
        end if
        EOF
      ]]>
    </url>
  </vkopenurldef>


  <item>
    <name>Mouse: XButtonUp, XButtonDown</name>
    <appendix>XButtonUp open/close KeyUp</appendix>
    <appendix>XButtonUp+CursorMove as Arrows</appendix>
    <appendix>* Configure `Parameters` -> `PointingRelative to Key` -> `Detection interval`</appendix>
    <appendix>XButtonDown as Option+RightClick</appendix>
    <identifier>private.mouse_map_XButtonUpDown</identifier>

    <!-- X-Up -->
    <autogen>
      __KeyOverlaidModifier__
      PointingButton::BUTTON5,
      KeyCode::VK_MODIFIER_EXTRA1,
      KeyCode::VK_OPEN_URL_toggle_keyup
    </autogen>
    <autogen>
      __PointingRelativeToKey__
      ModifierFlag::EXTRA1,
      PointingRelative::UP,    KeyCode::CURSOR_UP,
      PointingRelative::DOWN,  KeyCode::CURSOR_DOWN,
      PointingRelative::LEFT,  KeyCode::CURSOR_LEFT,
      PointingRelative::RIGHT, KeyCode::CURSOR_RIGHT
    </autogen>

    <!-- X-Down -->
    <autogen>
      __KeyToKey__
      PointingButton::BUTTON4,
      PointingButton::RIGHT, ModifierFlag::OPTION_L
    </autogen>
  </item>

  <item>
    <name>Mouse: LeftButton, RightButton</name>
    <appendix>Simultaneously RightButton+Click as Shift+Click</appendix>
    <appendix>RightButton+Click as Command+Click</appendix>
    <appendix>* RightButton+Click as Control+Click (Terminal)</appendix>
    <appendix>RightButton+LongClick as ForceTouch</appendix>
    <appendix>* RightButton+LongClick as ESC+ChangeIME (Terminal)</appendix>
    <identifier>private.mouse_map_LeftRightButton</identifier>

    <!-- R+Click (Simultaneous) -->
    <autogen>
      __SimultaneousKeyPresses__
      PointingButton::LEFT, PointingButton::RIGHT, 
      PointingButton::LEFT, ModifierFlag::SHIFT_L
    </autogen>

    <!-- R+Click, R+LongClick -->
    <autogen>
      __KeyOverlaidModifier__
      PointingButton::RIGHT,
      KeyCode::VK_MODIFIER_EXTRA2,
      PointingButton::RIGHT
    </autogen>
    <block>
      <!-- Other App -->
      <not>TERMINAL</not>
      <autogen>
        __HoldingKeyToKey__
        PointingButton::LEFT, ModifierFlag::EXTRA2
        @begin
        PointingButton::LEFT, ModifierFlag::COMMAND_L
        @end
        @begin
        KeyCode::D, ModifierFlag::COMMAND_L | ModifierFlag::CONTROL_L
        @end
        ThresholdMillisecond::RawValue::200
      </autogen>
    </block>
    <block>
      <!-- Terminal Only -->
      <only>TERMINAL</only>
      <autogen>
        __HoldingKeyToKey__
        PointingButton::LEFT, ModifierFlag::EXTRA2
        @begin
        PointingButton::LEFT, ModifierFlag::CONTROL_L
        @end
        @begin
        KeyCode::ESCAPE, KeyCode::ESCAPE,
        KeyCode::VK_CHANGE_INPUTSOURCE_ENGLISH
        @end
        ThresholdMillisecond::RawValue::200
      </autogen>
    </block>
  </item>

  <item><name>──────────────────────────────</name></item>
</root>
